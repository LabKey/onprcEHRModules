<script type="text/javascript">

LABKEY.requiresScript("/ehr/navMenu.js");
LABKEY.requiresScript("/ehr/utils.js");

Ext.onReady(createNavMenu);

function createNavMenu()
{
    if (!window.EHR || !window.EHR.ext || !window.EHR.ext.NavMenu)
    {
        createNavMenu.defer(10);
        return;
    }

    var webpart = <%=webpartContext%>;
    var ctx = EHR.Utils.getEHRContext(webpart.wrapperDivId);
    if(!ctx)
        return;


    var issueHTML = '';
    if (ctx['EHRIssuesContainer']){
        issueHTML = '<div style="max-width:920px">Below are the sections of the Electronic Health Record.  If there are additional reports you would like, please submit a request <a href=="' + LABKEY.ActionURL.buildURL('issues', 'list', ctx['EHRIssuesContainer']) + '" target="_blank">here</a>.<br><br></div>'
    }

    Ext.get(webpart.wrapperDivId).update(
        issueHTML +
        '<table>' +
        '<tr style="vertical-align:top">' +
        '    <td style="width:300px">' +
        '        <div id="ehrMenu1_'+webpart.wrapperDivId+'"></div>' +
        '    </td>' +
        '    <td style="width:300px;vertical-align:top">' +
        '        <div id="ehrMenu2_'+webpart.wrapperDivId+'"></div>' +
        '    </td>' +
        '    <td style="width:300px">' +
        '        <div id="ehrMenu3_'+webpart.wrapperDivId+'"></div>' +
        '    </td>' +
        '</tr>' +
        '</table>'
    );

    new EHR.ext.NavMenu({
        width: 270,
        renderTo: 'ehrMenu1_'+webpart.wrapperDivId,
        sections: [
            {header: 'By Animal',
            items: [
                {name: 'Animal History', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/animalHistory.view?'},
                {name: 'Animal Search', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/animalSearch.view?'}
                ]},
            {header: 'By Dataset',
            items: [
                {name: 'Browse All Datasets', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/datasets.view?'},
                {name: 'Clinical Remarks', url: '<%=contextPath%>/query' + ctx['EHRStudyContainer'] + '/executeQuery.view?schemaName=study&query.queryName=Clinical%20Remarks'},
                {name: 'Housing Queries', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/housingQueries.view?'},
                {name: 'Protocol and Project Queries', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/projectQueries.view?'}
            ]},
            {header: 'By Location',
            items: [
                {name: 'Search By Room, Floor or Cage', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/animalHistory.view#_inputType:renderRoomCage'}
                //{name: 'Irregular Obs By Location', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/animalHistory.view#_inputType:renderRoomCage&activeReport:obs'}
            ]}
        ]
    });

    new EHR.ext.NavMenu({
        width: 270,
        renderTo: 'ehrMenu2_'+webpart.wrapperDivId,
        sections: [{
            header: 'Today At The Center',
            items: [
                {name: 'Blood Draw Schedule', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/animalHistory.view#_inputType:renderColony&_showReport:1&combineSubj:true&activeReport:todaysBlood'},
                {name: 'Clinical TODO', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/animalHistory.view#_inputType:renderRoomCage&activeReport:obs'}
                //{name: 'Treatment Schedule - AM', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/animalHistory.view#_inputType:renderRoomCage&activeReport:treatmentScheduleAM'},
                //{name: 'Treatment Schedule - PM', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/animalHistory.view#_inputType:renderRoomCage&activeReport:treatmentSchedulePM'},
                //{name: 'Treatment Schedule - Night', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/animalHistory.view#_inputType:renderRoomCage&activeReport:treatmentScheduleNight'}
                //{name: 'Treatment Schedule - All', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/animalHistory.view#_inputType:renderRoomCage&activeReport:treatmentSchedule'},
                //{name: 'Forms Completed Today', url: '<%=contextPath%>/query' + ctx['EHRStudyContainer'] + '/executeQuery.view?schemaName=ehr&query.queryName=TasksByLocation&query.viewName=Completion Times&query.taskid/Created~dateeq='+(new Date()).format('Y-m-d')}
            ]
        },{
            header: 'Entire Colony',
            items: [
                //{name: 'Animal Utilization By Category', url: '<%=contextPath%>/query' + ctx['EHRStudyContainer'] + '/executeQuery.view?schemaName=study&query.queryName=colonyAssignmentSummary'},
                {name: 'Colony Population By Age', url: '<%=contextPath%>/query' + ctx['EHRStudyContainer'] + '/executeQuery.view?schemaName=study&query.queryName=colonyPopulationByAge'},
                {name: 'Population Summary', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/populationOverview.view?'},
                {name: 'Room Utilization', url: '<%=contextPath%>/query' + ctx['EHRStudyContainer'] + '/executeQuery.view?schemaName=ehr&query.queryName=RoomUtilization'},
                //{name: 'Time Chart', url: '<%=contextPath%>/visualization' + ctx['EHRStudyContainer'] + '/timeChartWizard.view?edit=true'},
                {name: 'More Reports', url: '<%=contextPath%>/onprc_ehr' + ctx['EHRStudyContainer'] + '/moreReports.view?'}
            ]
        }]
    });

    var menuCfg = {
        width: 270,
        renderTo: 'ehrMenu3_'+webpart.wrapperDivId,
        sections: [
            {header: 'Misc',
            items: [
                //{name: 'About the EHR Project', url: '<%=contextPath%>/project' + ctx['EHRStudyContainer'] + '/About The EHR/begin.view?'},
                {name: 'Compare Lists of Animals', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/utilities.view?'},
                //{name: 'Run SQL Directly', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/executeSql.view?'},
                {name: 'Search Center SNOMED Codes', url: '<%=contextPath%>/query' + ctx['EHRStudyContainer'] + '/executeQuery.view?schemaName=ehr_lookups&query.queryName=snomed'}
            ]},
            {header: 'Data Entry',
            items: [
                {name: 'Enter Data', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/dataEntry.view'}
            ]},
            {header: 'Request Services',
            items: [
                {name: 'Views Requests', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/requestServices.view'},
                {name: 'Request Blood Draws', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/manageRequest.view?formtype=Blood%20Draw%20Request'},
                {name: 'Request Clinpath Services', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/manageRequest.view?formtype=Clinpath%20Request'}
            ]}
        ]
    };

    if (LABKEY.Security.currentUser.isAdmin){
        menuCfg.sections.push({
            header: 'Admin',
            items: [
                {name: 'EHR Admin Page', url: '<%=contextPath%>/onprc_ehr' + ctx['EHRStudyContainer'] + '/ehrAdmin.view'},
                {name: 'Manage EHR Study', url: '<%=contextPath%>/study' + ctx['EHRStudyContainer'] + '/manageStudy.view?'}
                //{name: 'Manage Lookup Tables', url: '<%=contextPath%>/ehr' + ctx['EHRStudyContainer'] + '/dataAdmin.view'}
            ]
        })

    }

    new EHR.ext.NavMenu(menuCfg);

}

</script>