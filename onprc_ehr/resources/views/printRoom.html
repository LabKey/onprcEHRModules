<style type="text/css">
    @page {
        size: landscape;
    }

    .break { page-break-after:always; }
</style>
<script type="text/javascript">

    Ext4.onReady(function (){
        if (!LABKEY.ActionURL.getParameter('area') && !LABKEY.ActionURL.getParameter('rooms')){
            alert('Must Provide The Area or Room Name'); return false;
        }

        var webpart = <%=webpartContext%>;
        var filterArray = [LABKEY.Filter.create('room/datedisabled', null, LABKEY.Filter.Types.ISBLANK)];

        //preferentially use room over area if both provided
        if (LABKEY.ActionURL.getParameter('rooms') != null){
            filterArray.push(LABKEY.Filter.create('room', LABKEY.ActionURL.getParameterArray('rooms').join(';'), LABKEY.Filter.Types.EQUALS_ONE_OF));
        }
        else if (LABKEY.ActionURL.getParameter('area') != null){
            filterArray.push(LABKEY.Filter.create('area', LABKEY.ActionURL.getParameter('area'), LABKEY.Filter.Types.EQUAL));
        }

        LABKEY.Query.selectRows({
            schemaName: 'ehr_lookups',
            queryName: 'rooms',
            filterArray: filterArray,
            scope: this,
            failure: LDK.Utils.getErrorCallback(),
            success: function(results){
                if (results && results.rows){
                    Ext4.Array.each(results.rows, function(r, idx){
                        var target = Ext4.get(webpart.wrapperDivId).createChild({tag: 'div', cls: (idx+1 < results.rows.length ? 'page-break' : null)});

                        Ext4.create('ONPRC.panel.RoomLayoutPanel', {
                            showAnimalDetails: Ext4.data.Types.BOOLEAN.convert(LABKEY.ActionURL.getParameter('showAnimalDetails')),
                            doRowInversion: Ext4.data.Types.BOOLEAN.convert(LABKEY.ActionURL.getParameter('doRowInversion')),
                            printMode: 1,
                            filterArray: [LABKEY.Filter.create('room', r.room)]
                        }).render(target.id);
                    }, this);
                }
            }
        });
    });

</script>
